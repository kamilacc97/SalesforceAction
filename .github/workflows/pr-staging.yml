# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the master branch
  pull_request:
    branches: [ staging ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel



jobs:
    build-deploy:
        runs-on: ubuntu-latest
        steps:

            # Checkout the code in the pull request
            - name: 'Checkout source code'
              uses: actions/checkout@v2

            - name: 'Build and Deploy'
              uses: tiagonnascimento/sfdx-orgdev-build-deploy@v2
              with:
                type: 'production'
                certificate_path: assets/server.key.enc
                decryption_key: ${{ secrets.DECRYPTION_KEY }}
                decryption_iv: ${{ secrets.DECRYPTION_IV }}
                client_id: ${{ secrets.CONSUMER_KEY }}
                username: ${{ secrets.USERNAME }}
                checkonly: false
                deploy_wait_time: '10'
                manifest_path: package.xml
                deploy_testlevel: 'NoTestRun'

# jobs:
#   # This workflow contains a single job called "build"
#   build:
#     # The type of runner that the job will run on
#     runs-on: ubuntu-latest
#     with:
      
    
#     # Steps represent a sequence of tasks that will be executed as part of the job
#     steps:
#       # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
#       - uses: actions/checkout@v2
#       - run: |
#           wget https://developer.salesforce.com/media/salesforce-cli/sfdx/channels/stable/sfdx-linux-x64.tar.xz
#           mkdir ~/sfdx
#           tar xJf sfdx-linux-x64.tar.xz -C ~/sfdx --strip-components 1
#           export PATH=~/sfdx/bin:$PATH
#           PATH=~/sfdx/bin:$PATH
#           sfdx force
      
#       - name: 'test sfdx'
#         run: sfdx force
      
          
      
#       - name: ' authorize sf'
#         run: |
#           openssl enc -nosalt -aes-256-cbc -d -in assets/server.key.enc -out server.key -base64 -K ${{secrets.DECRYPTION_KEY}} -iv ${{secrets.DECRYPTION_IV}}
#           sfdx force:auth:jwt:grant --clientid=${{ secrets.CONSUMER_KEY }} --username=${{ secrets.USERNAME }} --jwtkeyfile server.key --setdefaultdevhubusername --setalias=hub-org
#       - name: 'Creating manifest'
#         run: |
#           sfdx force:source:manifest:create --sourcepath ObjectsToDeploy 
#           ls
#       - name: 'Deploy manifest'
#         run: sfdx force:source:deploy -g -u hub-org -x package.xml 
          
          
          
          
          

